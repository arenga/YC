<!DOCTYPE html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if page.title %}{{ page.title }} - {% endif %}{{ site.title }}</title>
  <meta name="description" content="{{ page.excerpt | default: site.description | strip_html | normalize_whitespace | truncate: 160 | escape }}">
  {% seo %}
  <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable-dynamic-subset.min.css" />
  <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}">
</head>
<body>
  <header class="site-header" id="site-header">
    <nav class="nav-container">
      <a href="{{ '/' | relative_url }}" class="site-title">ì•„ê³ ë¼</a>
      <div class="nav-links">
        <a href="{{ '/' | relative_url }}">í™ˆ</a>
        <a href="{{ '/bookmarks/' | relative_url }}">
          <span class="nav-icon">ğŸ”–</span> ë¶ë§ˆí¬
          <span id="bookmark-badge" class="bookmark-badge" style="display: none;">0</span>
        </a>
      </div>
      <div class="nav-actions">
        <button id="theme-toggle" class="theme-toggle" type="button" aria-pressed="false" aria-label="ë‹¤í¬ ëª¨ë“œ ì „í™˜">ğŸŒ™</button>
      </div>
    </nav>
  </header>

  <main class="main-content">
    {{ content }}
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 ì•„ê³ ë¼. Paul Graham ì—ì„¸ì´ í•œêµ­ì–´ ë²ˆì—­.</p>
    <p>ì›ë¬¸: <a href="https://paulgraham.com/" target="_blank" rel="noopener">paulgraham.com</a></p>
  </footer>

  <button class="toc-fab" id="toc-fab" type="button" aria-label="ëª©ì°¨ë¡œ ì´ë™">â˜°</button>
  <button class="scroll-top" id="scroll-top" type="button" aria-label="ë§¨ ìœ„ë¡œ ì´ë™">â†‘</button>

  <script>
    (function headerHideOnScroll() {
      const header = document.getElementById('site-header');
      if (!header) return;
      let lastY = window.scrollY;
      window.addEventListener('scroll', () => {
        const currentY = window.scrollY;
        const isScrollingDown = currentY > lastY && currentY > 80;
        header.classList.toggle('hide', isScrollingDown);
        lastY = currentY;
      }, { passive: true });
    })();

    (function backToTop() {
      const btn = document.getElementById('scroll-top');
      if (!btn) return;
      const toggle = () => {
        if (window.scrollY > 400) btn.classList.add('show');
        else btn.classList.remove('show');
      };
      window.addEventListener('scroll', toggle, { passive: true });
      btn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));
      toggle();
    })();

    (function themeToggle() {
      const storageKey = 'agora-theme';
      const root = document.documentElement;
      const btn = document.getElementById('theme-toggle');

      function applyTheme(theme) {
        root.setAttribute('data-theme', theme);
        root.classList.toggle('theme-dark', theme === 'dark');
        root.classList.toggle('theme-light', theme === 'light');
        document.body.classList.toggle('theme-dark', theme === 'dark');
        document.body.classList.toggle('theme-light', theme === 'light');
        localStorage.setItem(storageKey, theme);
        if (btn) {
          const isDark = theme === 'dark';
          btn.setAttribute('aria-pressed', String(isDark));
          btn.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
          btn.title = isDark ? 'ë¼ì´íŠ¸ ëª¨ë“œë¡œ' : 'ë‹¤í¬ ëª¨ë“œë¡œ';
        }
      }

      const preferred = (() => {
        const saved = localStorage.getItem(storageKey);
        if (saved === 'dark' || saved === 'light') return saved;
        return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
      })();

      applyTheme(preferred);
      if (btn) {
        btn.addEventListener('click', () => {
          const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          applyTheme(next);
        });
      }
    })();

    (function updateBookmarkBadge() {
      const badge = document.getElementById('bookmark-badge');
      if (!badge) return;

      function updateCount() {
        try {
          const bookmarks = JSON.parse(localStorage.getItem('agora-bookmarks')) || [];
          if (bookmarks.length > 0) {
            badge.textContent = bookmarks.length;
            badge.style.display = 'inline-block';
          } else {
            badge.style.display = 'none';
          }
        } catch {
          badge.style.display = 'none';
        }
      }

      updateCount();
      window.addEventListener('storage', updateCount);

      // Custom event for same-page updates
      window.addEventListener('bookmarksUpdated', updateCount);
    })();
  </script>
</body>
</html>
