---
layout: default
---

<article class="essay">
  <nav class="breadcrumb" aria-label="현재 위치">
    <a href="{{ '/' | relative_url }}">홈</a>
    <span aria-hidden="true">/</span>
    <a href="{{ '/essays/' | relative_url }}">전체 에세이</a>
    <span aria-hidden="true">/</span>
    <a href="{{ '/' | relative_url }}?category={{ page.category | uri_escape }}">{{ site.category_names[page.category] | default: page.category }}</a>
    <span aria-hidden="true">/</span>
    <span aria-current="page">{{ page.title }}</span>
  </nav>

  <div class="reading-progress" aria-hidden="true">
    <span id="reading-progress-bar"></span>
  </div>

  <div class="essay-header">
    <h1 class="essay-title">{{ page.title }}</h1>
    <div class="essay-meta">
      <span class="category">{{ site.category_names[page.category] | default: page.category }}</span>
      <span class="difficulty">{{ site.difficulty_levels[page.difficulty] | default: page.difficulty }}</span>
      {% if page.year %}
      <span class="year">{{ page.year }}</span>
      {% endif %}
    </div>
    <a href="{{ page.url_original }}" class="original-link" target="_blank" rel="noopener">원문 보기 →</a>
  </div>

  <nav class="toc" aria-label="본문 바로가기">
    <div class="toc-header">
      <p class="toc-title">본문 바로가기</p>
      <p class="toc-hint">중간 소제목으로 바로 이동하세요.</p>
    </div>
    <ul id="toc-list"></ul>
  </nav>

  <div class="essay-content">
    {{ content }}
  </div>

  <div class="essay-footer">
    <a href="{{ '/' | relative_url }}" class="back-link">← 목록으로 돌아가기</a>

    <div class="share-buttons">
      <button onclick="shareKakao()">카카오톡 공유</button>
      <button onclick="copyLink()">링크 복사</button>
    </div>
  </div>
</article>

<script>
  (function buildToc() {
    const headings = Array.from(document.querySelectorAll('.essay-content h2, .essay-content h3'));
    const tocList = document.getElementById('toc-list');
    if (!headings.length || !tocList) {
      const toc = document.querySelector('.toc');
      if (toc) toc.style.display = 'none';
      return;
    }

    function slugify(text) {
      return text
        .toLowerCase()
        .replace(/[^a-z0-9가-힣\s-]/g, '')
        .trim()
        .replace(/\s+/g, '-');
    }

    headings.forEach((heading) => {
      const text = heading.innerText.trim();
      if (!text) return;
      if (!heading.id) heading.id = slugify(text);
      const li = document.createElement('li');
      li.className = heading.tagName.toLowerCase() === 'h3' ? 'toc-item depth-2' : 'toc-item depth-1';
      const a = document.createElement('a');
      a.href = '#' + heading.id;
      a.textContent = text;
      li.appendChild(a);
      tocList.appendChild(li);
    });
  })();

  (function readingProgress() {
    const bar = document.getElementById('reading-progress-bar');
    if (!bar) return;
    function update() {
      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      const docHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const progress = docHeight > 0 ? (scrollTop / docHeight) * 100 : 0;
      bar.style.width = progress + '%';
    }
    window.addEventListener('scroll', update, { passive: true });
    window.addEventListener('resize', update);
    update();
  })();

  function copyLink() {
    const url = window.location.href;
    navigator.clipboard.writeText(url).then(() => {
      alert('링크가 복사되었습니다!');
    });
  }

  function shareKakao() {
    // Kakao SDK integration would go here
    alert('카카오톡 공유 기능은 준비 중입니다.');
  }
</script>
