import * as fs from 'fs';
import * as path from 'path';

interface AnalyzedEssay {
  title: string;
  url: string;
  year?: string;
  content: string;
  scrapedAt: string;
  analysis: {
    primaryCategory: string;
    difficulty: string;
    koreanSummary: string;
    keyTakeaways: string[];
    relevanceToKoreanContext: string;
    analyzedAt: string;
  };
}

// 10개 샘플 에세이에 대한 맞춤형 Summary
const manualSummaries: Record<string, string> = {
  'How to Do Great Work': `🎯 위대한 일을 하려면 무엇부터 시작해야 할까요?

✨ 핵심 내용 요약

Paul Graham은 이 에세이에서 다양한 분야에서 위대한 성과를 내는 방법의 공통점을 탐구합니다. 핵심은 네 단계입니다: (1) 자신이 타고난 재능이 있고 깊은 흥미를 느끼는 분야를 선택하고, (2) 그 분야의 최전선까지 충분히 배우고, (3) 지식의 틈새를 발견하고, (4) 유망한 것들을 탐구하는 것입니다.

가장 중요한 것은 "과도하게 호기심을 느끼는 것"을 찾는 것입니다. 다른 사람들이 지루해할 정도로 당신만 열정적으로 파고드는 주제, 그것이 바로 당신의 길입니다. 계획을 세우기보다는 각 단계에서 가장 흥미로운 것을 선택하고, 어려운 프로젝트에 열심히 일하면 좋은 결과가 따라옵니다. 일관성이 핵심입니다 - 하루에 많은 것을 하는 게 아니라 매일 무언가를 하는 것이 중요합니다.

**핵심 포인트**
• 자신이 과도하게 호기심을 느끼는 분야를 찾으세요 - 그것이 당신의 일입니다
• 계획보다는 흥미를 따라가세요 - "upwind"를 유지하며 항해하세요
• 일관성이 핵심입니다 - 매일 조금씩이라도 진행하면 복리 효과가 생깁니다

🚀 오늘 바로 실천해볼 한 가지
오늘 하루 동안 당신이 가장 호기심을 느끼는 주제가 무엇인지 관찰하고 메모해보세요.`,

  'Having Kids': `🎯 아이를 갖는 것, 두려움과 현실 사이의 간극

✨ 핵심 내용 요약

Paul Graham은 아이를 갖기 전에는 두려웠지만, 실제로 아이를 가진 후 생각이 완전히 바뀌었다고 고백합니다. 아이를 갖기 전에는 부모가 "재미없고 책임감만 있는 사람"이라고 생각했지만, 실제로는 아이와 함께하는 순간들이 인생에서 가장 평화롭고 의미 있는 시간이었습니다.

흥미로운 점은 관찰 편향(selection bias)입니다. 우리는 아이들이 문제를 일으킬 때만 주목하고, 비행기나 공공장소 같은 최악의 상황에서만 아이들을 목격합니다. 하지만 실제로는 아이들과 함께 산책하거나 그네를 밀어주는 평범한 순간들이 가장 행복한 시간입니다. 아이를 갖으면 생산성은 줄어들지만, 실제 행복한 순간의 수는 오히려 증가합니다.

**핵심 포인트**
• 아이에 대한 두려움은 대부분 잘못된 관찰에서 비롯됩니다
• 아이와 함께하는 평범한 순간들이 가장 큰 행복을 줍니다
• 야망이 줄어드는 것을 두려워하지 마세요 - 그만한 가치가 있습니다

🚀 오늘 바로 실천해볼 한 가지
주변의 부모들에게 진심으로 물어보세요: "아이를 갖길 잘했다고 생각하나요?"`,

  'How to Lose Time and Money': `🎯 시간과 돈을 잃는 가장 위험한 방법

✨ 핵심 내용 요약

Paul Graham은 부자에서 가난해지는 가장 흔한 방법이 과소비가 아니라 "나쁜 투자"라고 말합니다. 사치품을 사면 경보가 울리지만, 투자는 "돈을 쓰는 게 아니라 옮기는 것"처럼 느껴지기 때문입니다.

놀랍게도 시간도 똑같습니다. 가장 위험한 시간 낭비는 "재미있게 노는 것"이 아니라 "가짜 일(fake work)"을 하는 것입니다. TV를 하루 종일 보면 경보가 울리지만, 이메일 정리나 회의처럼 "일처럼 보이는" 활동을 하면 경보가 울리지 않습니다. 책상에 앉아 있고, 재미없으니 일처럼 느껴지지만 실제로는 아무것도 이루지 못하는 시간입니다.

**핵심 포인트**
• 돈을 잃는 가장 큰 이유는 과소비가 아니라 나쁜 투자입니다
• 시간을 잃는 가장 큰 이유는 게으름이 아니라 가짜 일입니다
• 현대 사회의 함정은 "미덕처럼 보이는" 시간 낭비를 만들어냅니다

🚀 오늘 바로 실천해볼 한 가지
오늘 하루 일과를 돌아보고 "진짜 일"과 "가짜 일"을 구분해보세요.`,

  'Founder Mode': `🎯 전문 경영인의 조언이 왜 스타트업을 망칠까요?

✨ 핵심 내용 요약

에어비앤비의 브라이언 체스키는 회사가 커지면서 "좋은 사람을 뽑고 맡기세요"라는 조언을 받았습니다. 하지만 이 전통적인 경영 방식은 참담한 결과를 가져왔죠. Paul Graham은 이 에세이에서 창업자만의 독특한 운영 방식인 "Founder Mode"를 소개합니다.

핵심은 이겁니다: 창업자는 전문 경영인처럼 조직도의 직속 부하를 통해서만 소통할 필요가 없습니다. 스티브 잡스가 애플에서 가장 중요한 100명을 모아 수련회를 한 것처럼, 조직 전체와 직접 연결되어야 합니다. "세부 관리는 나쁘다"는 통념을 버리고, 중요한 부분에는 깊이 관여하세요. 창업자만의 방식을 찾는 것이 성장의 열쇠입니다.

**핵심 포인트**
• 조직도만 보고 판단하지 마세요 - 현장의 목소리를 직접 들으세요
• 세부 관리 금기를 거부하세요 - 중요한 부분은 깊이 관여해야 합니다
• 전문 경영인의 조언을 맹신하지 마세요 - 창업자만의 방식을 찾으세요

🚀 오늘 바로 실천해볼 한 가지
오늘 팀 전체 회의를 열고 직접 현장의 목소리를 들어보세요.`,

  'The Shape of the Essay Field': `🎯 에세이는 어떻게 생각의 도구가 되는가?

✨ 핵심 내용 요약

Paul Graham은 에세이를 단순한 글쓰기가 아니라 "생각하는 방식"으로 봅니다. 좋은 에세이는 미리 계획한 주장을 전달하는 게 아니라, 쓰면서 발견해가는 여정입니다. 마치 대화처럼 자연스럽게 흘러가야 하며, 독자를 놀라게 할 수 있어야 합니다.

에세이의 본질은 "탐구"입니다. 당신이 무언가에 대해 궁금해하고, 그것을 탐구하면서 새로운 것을 발견하는 과정이 에세이입니다. 가장 좋은 에세이는 작가 자신도 미처 몰랐던 것을 발견하게 만듭니다. 따라서 에세이를 쓸 때는 결론을 미리 정하지 말고, 호기심이 이끄는 대로 탐구하세요.

**핵심 포인트**
• 에세이는 설득이 아니라 탐구의 도구입니다
• 글을 쓰면서 생각이 발전하고 명확해집니다
• 독자를 놀라게 할 수 있는 발견을 담으세요

🚀 오늘 바로 실천해볼 한 가지
궁금한 주제 하나를 정하고, 답을 미리 정하지 말고 탐구하는 글을 써보세요.`,

  'Good Writing': `🎯 좋은 글쓰기의 비밀은 무엇일까요?

✨ 핵심 내용 요약

Paul Graham은 좋은 글쓰기의 핵심은 "단순함"이라고 말합니다. 복잡하고 화려한 문장이 아니라, 생각을 가장 직접적이고 명확하게 전달하는 문장이 좋은 글입니다. 많은 사람들이 지적으로 보이려고 복잡하게 쓰지만, 정작 최고의 작가들은 가장 단순하게 씁니다.

좋은 글을 쓰는 방법은 대화하듯 쓰는 것입니다. 친구에게 설명하듯이 자연스럽게, 불필요한 단어는 모두 제거하세요. 그리고 계속 다시 쓰세요. 첫 초안은 항상 형편없습니다. 중요한 것은 계속 다듬고 개선하는 것입니다. 글쓰기는 생각하기이며, 글을 다듬는 것은 생각을 다듬는 것입니다.

**핵심 포인트**
• 단순하고 직접적으로 쓰세요 - 화려함은 독자를 방해합니다
• 대화하듯 자연스럽게 쓰세요 - 격식은 거리감을 만듭니다
• 계속 다시 쓰세요 - 좋은 글은 다듬기에서 나옵니다

🚀 오늘 바로 실천해볼 한 가지
어제 쓴 이메일이나 문서를 꺼내서 절반으로 줄여보세요.`,

  'What to Do': `🎯 무엇을 할지 모르겠다면?

✨ 핵심 내용 요약

많은 사람들이 "무엇을 해야 할지" 고민합니다. Paul Graham의 조언은 간단합니다: 일단 시작하세요. 완벽한 계획을 세우려고 기다리지 말고, 흥미로운 것을 발견하면 바로 탐구하세요.

중요한 것은 "흥미로움"입니다. 돈이나 명성, 남들의 기대가 아니라 순수하게 당신이 흥미를 느끼는 것을 찾으세요. 그리고 그것을 꾸준히 탐구하세요. 처음에는 작고 사소해 보일 수 있지만, 진정한 흥미를 따라가다 보면 예상치 못한 큰 발견으로 이어집니다. 중요한 것은 움직이는 것입니다. 서 있으면 아무것도 배울 수 없습니다.

**핵심 포인트**
• 완벽한 계획을 기다리지 말고 일단 시작하세요
• 순수하게 흥미로운 것을 따라가세요
• 작게 시작해서 꾸준히 탐구하세요

🚀 오늘 바로 실천해볼 한 가지
오늘 가장 흥미롭다고 느낀 것 하나를 골라 30분 동안 탐구해보세요.`,

  'The Origins of Wokeness': `🎯 Wokeness는 어디서 왔을까?

✨ 핵심 내용 요약

Paul Graham은 현대의 "wokeness" 현상을 역사적 맥락에서 분석합니다. 그는 이것이 전적으로 새로운 것이 아니라, 과거 종교적 도덕주의의 현대판이라고 주장합니다. 중세의 종교재판처럼, 현대의 취소 문화도 도덕적 순수성을 강요하고 이단을 처벌하는 메커니즘을 가지고 있습니다.

흥미로운 점은 이런 현상이 특정 정치 성향과 무관하게 나타난다는 것입니다. 좌파든 우파든, 집단이 도덕적 우월감과 확신을 가지면 비슷한 패턴이 나타납니다. 해결책은 겸손과 회의주의입니다. 자신의 신념에 대해 조금은 의심하고, 다른 의견에 귀 기울이는 자세가 필요합니다.

**핵심 포인트**
• Wokeness는 새로운 것이 아니라 도덕주의의 현대판입니다
• 좌우를 막론하고 확신은 위험합니다
• 겸손과 회의주의가 해결책입니다

🚀 오늘 바로 실천해볼 한 가지
자신이 확신하는 신념 하나를 골라 반대 의견을 진지하게 들어보세요.`,

  'Writes and Write-Nots': `🎯 글을 쓰는 사람과 쓰지 않는 사람의 차이

✨ 핵심 내용 요약

Paul Graham은 글쓰기 능력이 점점 더 중요한 경쟁력이 되고 있다고 말합니다. 과거에는 글쓰기가 특정 직업(작가, 기자)의 전유물이었지만, 이제는 모든 지식 노동자에게 필수 기술이 되었습니다. 이메일, 보고서, 제안서, 블로그 등 우리는 매일 글을 씁니다.

문제는 글을 "쓸 수 있는 사람"과 "못 쓰는 사람" 사이의 격차가 점점 벌어지고 있다는 것입니다. 글을 잘 쓰는 사람은 자신의 생각을 명확하게 전달하고, 다른 사람을 설득하고, 기회를 만들어냅니다. 반면 글을 못 쓰는 사람은 아무리 좋은 아이디어가 있어도 전달하지 못합니다. 다행히 글쓰기는 연습으로 향상할 수 있습니다.

**핵심 포인트**
• 글쓰기는 이제 모든 지식 노동자의 필수 기술입니다
• 글을 잘 쓰는 사람과 못 쓰는 사람의 격차가 벌어지고 있습니다
• 글쓰기는 연습으로 향상할 수 있습니다

🚀 오늘 바로 실천해볼 한 가지
오늘부터 매일 15분 동안 생각을 글로 정리하는 습관을 만들어보세요.`,

  'When To Do What You Love': `🎯 좋아하는 일을 언제 시작해야 할까요?

✨ 핵심 내용 요약

많은 사람들이 "좋아하는 일을 하라"는 조언을 듣지만, 실제로 언제 어떻게 해야 할지 모릅니다. Paul Graham은 좋아하는 일을 하는 것이 사치가 아니라 필수라고 말합니다. 왜냐하면 정말 어려운 문제를 해결하려면 엄청난 에너지가 필요한데, 그 에너지는 오직 열정에서 나오기 때문입니다.

하지만 처음부터 완벽하게 좋아하는 일을 찾을 필요는 없습니다. 중요한 것은 "흥미로운 방향"으로 계속 나아가는 것입니다. 매 선택의 순간마다 조금 더 흥미로운 쪽을 선택하세요. 그러다 보면 자연스럽게 당신이 정말 사랑하는 일에 도달하게 됩니다. 완벽한 일을 기다리지 말고, 흥미로운 것을 향해 움직이세요.

**핵심 포인트**
• 좋아하는 일을 하는 것은 사치가 아니라 필수입니다
• 처음부터 완벽한 일을 찾을 필요는 없습니다
• 매 순간 조금 더 흥미로운 방향을 선택하세요

🚀 오늘 바로 실천해볼 한 가지
현재 하는 일 중에서 가장 흥미로운 부분을 찾아 더 많은 시간을 투자해보세요.`,
};

async function updateMarkdownFile(
  essay: AnalyzedEssay,
  newSummary: string
): Promise<void> {
  const { analysis } = essay;
  const categoryDir = path.join(
    process.cwd(),
    'essays',
    analysis.primaryCategory,
    analysis.difficulty
  );

  const filename =
    essay.title
      .replace(/[^a-zA-Z0-9가-힣\s-]/g, '')
      .replace(/\s+/g, '-')
      .substring(0, 100)
      .toLowerCase() + '.md';

  const filepath = path.join(categoryDir, filename);

  if (!fs.existsSync(filepath)) {
    console.log(`  ⚠️  File not found: ${filepath}`);
    return;
  }

  const content = fs.readFileSync(filepath, 'utf-8');

  // Summary 섹션을 새로운 내용으로 교체
  const summaryRegex = /## 요약 \(Summary\)\n\n[\s\S]*?\n\n---/;
  const newSummarySection = `## 요약 (Summary)\n\n${newSummary}\n\n---`;

  const updatedContent = content.replace(summaryRegex, newSummarySection);

  fs.writeFileSync(filepath, updatedContent, 'utf-8');
  console.log(`  ✅ Summary updated (${newSummary.length} chars)`);
}

async function updateSample() {
  console.log('🚀 10개 샘플 에세이 Summary 업데이트 시작...\n');

  const analyzedPath = path.join(process.cwd(), 'data', 'essays-analyzed.json');
  const essays: AnalyzedEssay[] = JSON.parse(
    fs.readFileSync(analyzedPath, 'utf-8')
  );

  let successCount = 0;
  let errorCount = 0;

  // 첫 10개 에세이 처리
  for (let i = 0; i < Math.min(10, essays.length); i++) {
    const essay = essays[i];
    console.log(`[${i + 1}/10] ${essay.title}`);

    try {
      const summary = manualSummaries[essay.title];
      if (summary) {
        await updateMarkdownFile(essay, summary);
        successCount++;
      } else {
        console.log(`  ⚠️  Manual summary not prepared for this essay`);
      }
    } catch (error: any) {
      console.error(`  ❌ Error:`, error.message);
      errorCount++;
    }
  }

  console.log(`\n✅ 업데이트 완료!`);
  console.log(`📊 성공: ${successCount} | 오류: ${errorCount}`);
}

updateSample()
  .then(() => {
    console.log('\n✨ 샘플 Summary 업데이트 완료!');
    process.exit(0);
  })
  .catch((error) => {
    console.error('\n💥 Fatal error:', error);
    process.exit(1);
  });
